{% extends 'base.html' %}

{% block content %}
<h1>{% block title %}Viewing Node {{ node }}{% endblock %}</h1>
<div class="row">
    <div class="col">
        <div class="row">
            <div class="col-sm-3 p-2 ml-4 mb-2">
                <label for="node-choose"><b>Node:</b></label>
            </div>
    
            <div class="col-sm-3 p-2 mr-4 mb-1">
                <select class="form-select form-select-sm" id="node-choose" name="node-choose" onchange="sensorSelect()">
                    <option value="1">Node 1</option>
                    <option value="2">Node 2</option>
                    <option value="3">Node 3</option>
                    <option value="4">Node 4</option>
                </select>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="row">
            <div class="col-sm-3 p-2 ml-4 mb-2">
                <label for="type-choose"><b>Reading type:</b></label>
            </div>
    
            <div class="col-sm-3 p-2 mr-4 mb-1">
                <select class="form-select form-select-sm" id="type-choose" name="type-choose" onchange="typeSelect()">
                    <option value="Temperature">Temperature</option>
                    <option value="Humidity">Humidity</option>
                </select>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="row">

            <div class="col-sm-3 p-2 ml-4 mb-2">
                <label for="node-choose"><b>Month:</b></label>
            </div>
  
            <div class="col-sm-4 p-2 mr-4 mb-1">
              <input type="month" id="month_picker" name="month_picker" min="2023-05" max="2023-09" value="2023-09" /> 
            </div>
  
          </div>
    </div>

</div>

<div class="row p-2 ml-4 mb-2" id="graph_title"><h4>Temperature Readings for Node {{ node }}</h4></div>
<div id="chart"></div>

<script>
    function selectElement(id, valueToSelect) {    
    let element = document.getElementById(id);
    element.value = valueToSelect;
    }

    var nodeId = {{ node }};

    selectElement('node-choose', nodeId);

    var options = {
            chart: {
                height: 350,
                type: 'area',
            },
            dataLabels: {
                enabled: false
            },
            series: [],
            noData: {
                text: 'Loading...'
            },
            fill: {
                colors: ['#FF0000'],
                type: 'gradient'
            },
            stroke: {
                colors: ['#FF0000']
            },
            xaxis: {
                type: 'datetime',
                labels: {
                    datetimeUTC: false,
                    format: 'dd MMM yyyy HH:MM',
                    show: true,
                    style: {
                        fontSize: '14px',
                        fontFamily: 'Helvetica, Arial, sans-serif',
                        fontWeight: 400,
                        cssClass: 'apexcharts-xaxis-label',
                    }
                },
            },
            yaxis: {
                labels: {
                    style: {
                        fontSize: '14px',
                        fontFamily: 'Helvetica, Arial, sans-serif',
                        fontWeight: 400,
                        cssClass: 'apexcharts-yaxis-label',
                    }
                }
            },
            tooltip: {
                x: {
                    datetimeUTC: false,
                    format: 'dd MMM yyyy HH:MM'
                }
            }
            }

            var chart = new ApexCharts(
            document.querySelector("#chart"),
            options
            );

            chart.render();

            var url = '/graphdata?nodeId=' + nodeId + '&sensorType=Temperature';

            fetch(url)
                .then((response) => response.json())
                .then((data) => {
                    var sensorValue = document.getElementById('sensor-choose');
                    var typeValue = document.getElementById('type-choose');
                    chart.updateSeries([{
                        name: typeValue.value,
                        data: data
                    }]);
                })
                .catch((error) => {
                    console.error('Error fetching data:', error);
                });



</script>
{% endblock %}