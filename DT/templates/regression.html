{% extends 'base.html' %}

{% block content %}
    {% include 'includes/regression-scripts.html' %}
    <div class="row">
        <div class="col-sm-2 p-2 ml-4 mb-2">
          <label for="month_picker">Select Month</label>
        </div>
        <div class="col-sm-4 p-2 mr-4 mb-1">
          <input type="month" id="month_picker" name="month_picker" min="2023-05" max="2023-09" value="2023-09" /> 
        </div>
        <div class="col-sm-4 p-2 mr-4 mb-1">
            <h4 id="text"></h4>
        </div>
      </div>
    <div class="row align-items-start">
        <div id="tester" style="width:90%;height:400px;"></div>
    </div>
    <script>
        TESTER = document.getElementById('tester');
        url = '/predict'
        var layout = {
            title: {
                text:'Temperature Readings for September 2023',
                font: {
                family: 'Arial, monospace',
                size: 24
                },
                xref: 'paper',
                x: 0.05,
            },
            xaxis: {
                title: {
                text: 'Time of Reading',
                font: {
                    family: 'Arial, monospace',
                    size: 18,
                    color: '#000000'
                }
                },
            },
            yaxis: {
                title: {
                text: 'Temperature (°C)',
                font: {
                    family: 'Arial, monospace',
                    size: 18,
                    color: '#000000'
                }
                }
            }
        };
        $.getJSON(url, 
        {month: 9}
        ,function(response) {
                data = response;
                console.log(data);
                var actualData = {
                    x: data['actual']['x'],
                    y: data['actual']['y'],
                    name: 'Sensor Readings',
                    type: 'scatter'
                };

                var cyclicData = {
                    x: data['cyclic']['x'],
                    y: data['cyclic']['y'],
                    name: 'Sine/Cosine Transformation',
                    type: 'scatter'
                };

                var plotData = [actualData, cyclicData]

                Plotly.newPlot( TESTER, plotData, layout);
        });
    </script>
    <script>
        const monthSelect = document.querySelector("#month_picker");
        const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
        monthSelect.onchange = () => {
                // var x = document.getElementById("text");
                myDate = new Date(monthSelect.value + "-01");
                var year = myDate.getFullYear();
                var month = myDate.getMonth() + 1;
                title = 'Temperature Readings for ' + months[myDate.getMonth()] + ' ' + myDate.getFullYear();
                var layout = {
                title: {
                    text: title,
                    font: {
                    family: 'Circular STD, monospace',
                    size: 24
                    },
                    xref: 'paper',
                    x: 0.05,
                },
                xaxis: {
                    title: {
                    text: 'Time of Reading',
                    font: {
                        family: 'Circular STD, monospace',
                        size: 18,
                        color: '#000000'
                    },
                    tickformat: '%d %B<br>%H:%M',
                    nticks: 11
                    },
                },
                yaxis: {
                    title: {
                    text: 'Temperature (°C)',
                    font: {
                        family: 'Circular STD, monospace',
                        size: 18,
                        color: '#000000'
                    }
                    }
                }
            };
            url = '/predict'
            $.getJSON(url, 
                {month: month},
                function(response) {
                data = response;
                var actualData = {
                    x: data['actual']['x'],
                    y: data['actual']['y'],
                    name: 'Sensor Readings',
                    type: 'scatter'
                };

                var cyclicData = {
                    x: data['cyclic']['x'],
                    y: data['cyclic']['y'],
                    name: 'Sine/Cosine Transformation',
                    type: 'scatter'
                };

                var plotData = [actualData, cyclicData]

                Plotly.newPlot( TESTER, plotData, layout);
            });
        };
    </script>
    {% include 'includes/scripts.html' %}

{% endblock %}